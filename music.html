<html>
	<head>
		<title>{{.Name}}</title>
		<style>
body { font-family: sans-serif;
	padding: 0;
	margin: 0;
	display: flex;
	flex-direction: row;
}
main {
	display: flex;
	flex-direction: column;
	flex-grow: 1;
	height: 100vh;
}
audio { 
	width: 100%;
	position: relative;
	z-index: 1;
}
main #img {
	flex-grow: 1;
	position: relative;
}
main #img img {
	position: absolute;
	top: 50%;
	left: 50%;
	transform: translate(-50%, -50%);
}
.sidebar {
	width: 350px;
	color: #fff;
	padding: 16px;
	position: relative;
	font-size: 16px;
}
.sidebar h1 {
	margin-top: 0;
	font-size: 20px;
}
.sidebar .close {
	cursor: pointer;
	position: absolute;
	top: 16px;
	right: 16px;
}
		</style>
	</head>
	<body>
		<main>
			<div id="img">
				<img src="/{{.Id}}/0.png">
			</div>
			<audio src="{{.Audio}}" controls></audio>
		</main>

		<div class="sidebar" style="background:{{.Color}}">
			<h1>{{.Name}}</h1>
			<p>By <u>{{.Composer}}</u></p>
			<p>{{.Description}}</p>
			<p>Performed by {{.Artist}}.</p>
			<span class="close" onclick="this.parentNode.style.display = 'none'">x</span>
		</div>

		<script>
		var map = {{.Map}};
		var arr = [];
		for (var key in map) {
			arr.push([key, map[key]]);
		}
		arr = arr.map(function(v, _) {
			v[0] = v[0] | 0;
			return v; }).sort(function(a, b) {
				return a[0] - b[0];		
			});

		var audio = document.getElementsByTagName("audio")[0];
		var img = document.getElementsByTagName("img")[0];
		audio.ontimeupdate = function(e) {
			var n = 0;
			if (this.currentTime*1000 < arr[0][0]) {
				n = 0;
			} else for (var i = 0; i < arr.length; i++) {
				if (arr[i][0] <= this.currentTime * 1000 && (
					arr[i + 1] == undefined ||
					arr[i + 1][0] > this.currentTime * 1000)) {
					n = arr[i][1];
				}
			}			
			if (!img.src.endsWith("/{{.Id}}/" + n + ".png"))
				img.src = "/{{.Id}}/" + n + ".png";
		}
		audio.onseeking = audio.ontimeupdate;

		document.onkeypress = function(e) {
			if (e.keyCode == 105 || e.which == 105) {
				var s = document.querySelector(".sidebar");
				if (s.style.display == "block") 
					s.style.display = "none";
				else
					s.style.display = "block";
			}
		}
		</script>
	</body>
</html>